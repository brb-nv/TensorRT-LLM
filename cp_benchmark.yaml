# SLURM Configuration
slurm:
  script_file: "disaggr_torch.slurm"
  partition: "batch"
  account: "coreai_horizon_dilations"
  job_time: "01:00:00"
  job_name: "trtllm-py-test"
  numa_bind: true

# Benchmark Mode
benchmark:
  mode: "e2e"  # Options: e2e, gen_only
  use_nv_sa_benchmark: false  # Whether to use NVIDIA SA benchmark script
  multi_round: 8  # Number of benchmark rounds
  benchmark_ratio: 0.8  # Benchmark ratio
  streaming: true  # Enable streaming mode
  concurrency_list: "1024"
  input_length: 1024  # Input sequence length
  output_length: 1024  # Output sequence length
  dataset_file: "/lustre/fsw/portfolios/coreai/users/xqiao/dataset/random-v2/deepseek-r1-1024-1024-200000-ratio-1_for_serve.json"

# Hardware Configuration
hardware:
  gpus_per_node: 4  # Modify this with your hardware configuration
  num_ctx_servers: 1  # Number of context servers
  num_gen_servers: 1  # Number of generation servers

# Environment Configuration
environment:
  container_mount: "/lustre/fsw/portfolios/coreai/projects/coreai_horizon_dilations:/lustre/fsw/portfolios/coreai/projects/coreai_horizon_dilations,/lustre/fsw/portfolios/coreai/users/xqiao:/lustre/fsw/portfolios/coreai/users/xqiao"  # Format: path1:path1,path2:path2
  container_image: "urm.nvidia.com/sw-tensorrt-docker/tensorrt-llm:pytorch-25.10-py3-x86_64-ubuntu24.04-trt10.13.3.9-skip-tritondevel-202511281406-9077"
  model_path: "/lustre/fsw/portfolios/coreai/projects/coreai_horizon_dilations/users/mjoux/data/models/DeepSeek-V3-Lite/bf16/"
  trtllm_repo: "/lustre/fsw/portfolios/coreai/projects/coreai_horizon_dilations/users/bbuddharaju/TensorRT-LLM_main/"
  build_wheel: true  # Don't build the wheel when launching multiple jobs
  work_dir: "/lustre/fsw/portfolios/coreai/projects/coreai_horizon_dilations/users/bbuddharaju/TensorRT-LLM_main/examples/disaggregated/slurm/benchmark/"

# Profiling Configuration
profiling:
  nsys_on: false  # Set to true to enable profiling

worker_config:
  gen:
    tensor_parallel_size: 4
    moe_expert_parallel_size: 4
    enable_attention_dp: false
    pipeline_parallel_size: 1
    context_parallel_size: 2
    cp_config:
      cp_type: "HELIX"
      tokens_per_block: 32  # must match kv_config.tokens_per_block.
    max_batch_size: 64
    max_num_tokens: 256
    max_seq_len: 2068
    cuda_graph_config: null
    print_iter_log: true
    kv_cache_config:
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.7
      tokens_per_block: 32
    cache_transceiver_config:
      max_tokens_in_buffer: 16384
      backend: UCX
    stream_interval: 20
    num_postprocess_workers: 4
  ctx:
    max_batch_size: 20
    max_num_tokens: 16640
    max_seq_len: 1044
    tensor_parallel_size: 4
    moe_expert_parallel_size: 4
    enable_attention_dp: true
    pipeline_parallel_size: 1
    context_parallel_size: 1
    print_iter_log: true
    cuda_graph_config: null
    disable_overlap_scheduler: true
    kv_cache_config:
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.6
    cache_transceiver_config:
      max_tokens_in_buffer: 16384
      backend: UCX
